# –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–†–û–ë–õ–ï–ú –°–ò–ú–£–õ–Ø–¶–ò–ò V2

## –î–∞—Ç–∞: 23 –æ–∫—Ç—è–±—Ä—è 2025

### ‚úÖ –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

#### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥—Ä–µ–≤–æ–≤–∏–¥–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (TreeView)**
   
**–ü—Ä–æ–±–ª–µ–º–∞:** TreeView –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª—Å—è, –ø–æ—Ç–æ–º—É —á—Ç–æ –ª–æ–≥ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª—Å—è –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.

**–†–µ—à–µ–Ω–∏–µ:**
- –û–±–Ω–æ–≤–ª–µ–Ω `simulation-panel.tsx` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∞ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ —Å —ç–º–æ–¥–∑–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- –õ–æ–≥ —Ç–µ–ø–µ—Ä—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö `data._raw.days`
- –§–æ—Ä–º–∞—Ç –≤–∫–ª—é—á–∞–µ—Ç:
  - üìÖ –î–µ–Ω—å X
  - ‚è∞ –ß–∞—Å X (–∞–±—Å–æ–ª—é—Ç–Ω—ã–π —á–∞—Å: Y)
  - üèÉ –û–ø–µ—Ä–∞—Ü–∏—è "–Ω–∞–∑–≤–∞–Ω–∏–µ"
  - ‚è∏Ô∏è –û–∂–∏–¥–∞—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
  - üí∞ –ë–∞–ª–∞–Ω—Å—ã –∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
  - üì¶ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã, üë∑ –¢—Ä—É–¥, ‚öôÔ∏è –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ

**–§–∞–π–ª—ã:**
- `app/app/orders/[id]/simulation-panel.tsx` - –Ω–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∞

#### 2. **–î–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–µ–Ω–∞ —Ü–µ–ø–æ—á–µ–∫ –∏ –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –ª–æ–≥–∏**

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –¥–∞–Ω–Ω—ã—Ö —Å–∏–º—É–ª—è—Ü–∏–∏ –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ ID —Ü–µ–ø–æ—á–µ–∫ –∏ –æ–ø–µ—Ä–∞—Ü–∏–π, –±–µ–∑ –∏—Ö –Ω–∞–∑–≤–∞–Ω–∏–π.

**–†–µ—à–µ–Ω–∏–µ:**
- –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö: –¥–æ–±–∞–≤–ª–µ–Ω—ã `chainName` –∏ `opName` –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
- `ChainHourLog` —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç `chainName?: string`
- `OperationHourLog` —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç `opName?: string`
- `ResourceManager.logOperationHour()` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `chainName`
- `SimulationEngine` –ø–µ—Ä–µ–¥–∞–µ—Ç –∏–º–µ–Ω–∞ —Ü–µ–ø–æ—á–µ–∫ –∏ –æ–ø–µ—Ä–∞—Ü–∏–π –ø—Ä–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏

**–§–∞–π–ª—ã:**
- `lib/simulation-v2/types.ts` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
- `lib/simulation-v2/ResourceManager.ts` - –æ–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `logOperationHour`
- `lib/simulation-v2/SimulationEngine.ts` - –ø–µ—Ä–µ–¥–∞—á–∞ –∏–º–µ–Ω –ø—Ä–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏

---

### ‚ÑπÔ∏è –°–¢–ê–¢–£–° –î–†–£–ì–ò–• –ü–†–û–ë–õ–ï–ú –ò–ó –î–û–ö–£–ú–ï–ù–¢–ê

#### 3. **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—Ö–æ–¥—ã - –ø–µ—Ä–µ–ø–ª–∞—Ç–∞ 2 –º–ª–Ω —Ä—É–±–ª–µ–π**

**–°—Ç–∞—Ç—É—Å: ‚úÖ –ü–†–û–ë–õ–ï–ú–´ –ù–ï–¢**

**–ê–Ω–∞–ª–∏–∑:**
- –¢–µ–∫—É—â–∏–π –∫–æ–¥ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–≤–æ–π–Ω–æ–≥–æ —Å–ø–∏—Å–∞–Ω–∏—è
- –ü—Ä–∏ `policy=daily`: —Ä–∞—Å—Ö–æ–¥—ã —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –Ω–∞ –¥–Ω–µ–≤–Ω—É—é –¥–æ–ª—é
- –ü—Ä–∏ `policy=end_of_simulation`: —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –∏ —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ
- –ú–µ—Ç–æ–¥ `applyPeriodicExpensesForDay` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ú–µ—Ç–æ–¥ `bookEndOfSimulationPeriodicCashOut` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω—É–∂–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–µ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ –±–æ–ª—å—à–∏–µ —Å—É–º–º—ã –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è `monthlyAmount` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (—Ç–∞–±–ª–∏—Ü–∞ `PeriodicExpense`)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å—É–º–º—ã —É–∫–∞–∑–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 50000‚ÇΩ/–º–µ—Å—è—Ü, –∞ –Ω–µ 5000000‚ÇΩ/–º–µ—Å—è—Ü)

#### 4. **–ú–∞—Ç–µ—Ä–∏–∞–ª—ã —Å 0% –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–æ–π**

**–°—Ç–∞—Ç—É—Å: ‚úÖ –ü–†–û–ë–õ–ï–ú–´ –ù–ï–¢**

**–ê–Ω–∞–ª–∏–∑:**
- –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª—ã —Å –ª—é–±—ã–º –ø—Ä–æ—Ü–µ–Ω—Ç–æ–º –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã
- –ï—Å–ª–∏ `materialPrepayPercent = 0`, —Ç–æ `prepayNet = 0`, `postpayNet = full amount`
- –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –∑–∞–∫—É–ø–∞—é—Ç—Å—è, –æ–ø–ª–∞—Ç–∞ –∏–¥–µ—Ç –ø—Ä–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (`etaProductionDay`)
- –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö –∑–Ω–∞—á–µ–Ω–∏–π –æ—Ç 0 –¥–æ 100%

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
- `materialPrepayPercent` - –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏–º—É–ª—è—Ü–∏–∏)
- `materialTwoPhasePayment` - –≤–∫–ª—é—á–∏—Ç—å –¥–≤—É—Ö—Ñ–∞–∑–Ω—É—é –æ–ø–ª–∞—Ç—É (–ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ + –ø–æ—Å—Ç–æ–ø–ª–∞—Ç–∞)
- –ï—Å–ª–∏ `materialTwoPhasePayment = false`, –≤—Å—è –æ–ø–ª–∞—Ç–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–∫–∞–∑–µ

---

### üìä –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï –ö–û–ú–ü–û–ù–ï–ù–¢–û–í

#### ‚úÖ **–†–∞–±–æ—Ç–∞—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
1. **SummaryTable** (`components/summary-table.tsx`) - —Å–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∑–∞—Ç—Ä–∞—Ç
2. **TableLogViewerV2** (`components/table-log-viewer-v2.tsx`) - —Ç–∞–±–ª–∏—á–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
3. **CashFlowChart** (`components/cash-flow-chart.tsx`) - –≥—Ä–∞—Ñ–∏–∫ –¥–µ–Ω–µ–∂–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤
4. **TreeLogViewer** (`components/tree-log-viewer.tsx`) - –¥—Ä–µ–≤–æ–≤–∏–¥–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

#### ‚ÑπÔ∏è **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –æ "FinancialTable":**
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Å –∏–º–µ–Ω–µ–º "FinancialTable" –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ø—Ä–æ–µ–∫—Ç–µ. –í–æ–∑–º–æ–∂–Ω–æ, –∏–º–µ–ª–∏—Å—å –≤ –≤–∏–¥—É:
- `SummaryTable` - –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏—Ç–æ–≥–æ–≤—É—é —Å–≤–æ–¥–∫—É –ø–æ –≤—Å–µ–º –∑–∞—Ç—Ä–∞—Ç–∞–º
- `TableLogViewerV2` - –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ –¥–Ω—è–º –∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º

–û–±–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.

---

### üîç –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –î–ò–ê–ì–ù–û–°–¢–ò–ö–ï

–ï—Å–ª–∏ –≤—ã –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –≤–∏–¥–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º–∏ —Ä–∞—Å—á–µ—Ç–∞–º–∏:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ:**
   ```sql
   -- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤
   SELECT id, name, amount, period, "isActive", "vatRate" 
   FROM "PeriodicExpense" 
   WHERE "productId" = '[ID_–í–ê–®–ï–ì–û_–ü–†–û–î–£–ö–¢–ê]';
   
   -- –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
   SELECT id, name, "unitCost", "minOrderQty", "minStock", 
          "leadTimeProductionDays", "leadTimeShippingDays" 
   FROM "Material" 
   WHERE "productId" = '[ID_–í–ê–®–ï–ì–û_–ü–†–û–î–£–ö–¢–ê]';
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏–º—É–ª—è—Ü–∏–∏:**
   - `initialCashBalance` - –Ω–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
   - `materialPrepayPercent` - –ø—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
   - `periodicExpensePaymentPolicy` - –ø–æ–ª–∏—Ç–∏–∫–∞ —Å–ø–∏—Å–∞–Ω–∏—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤
   - `monthDivisor` - –¥–µ–ª–∏—Ç–µ–ª—å –¥–ª—è –º–µ—Å—è—á–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ (–æ–±—ã—á–Ω–æ 30)

3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö —Å–∏–º—É–ª—è—Ü–∏–∏:**
   - –í –æ—Ç–≤–µ—Ç–µ API –µ—Å—Ç—å —Å–µ–∫—Ü–∏—è `diagnostics` —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `materialsFromDb` - —Ç–∞–º —É–∫–∞–∑–∞–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—Å–µ—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `materialOrders` - —Ç–∞–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤

---

### üìù –ò–¢–û–ì–ò

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ TreeView —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥—Ä–µ–≤–æ–≤–∏–¥–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–µ–Ω–∞ —Ü–µ–ø–æ—á–µ–∫ –∏ –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—Ö–æ–¥—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã —Å –ª—é–±—ã–º –ø—Ä–æ—Ü–µ–Ω—Ç–æ–º –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏–º—É–ª—è—Ü–∏—é –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ TreeView
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ, –µ—Å–ª–∏ —Å—É–º–º—ã –∫–∞–∂—É—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

---

### üöÄ –ü–†–û–ï–ö–¢ –û–ë–ù–û–í–õ–ï–ù –ò –ì–û–¢–û–í –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ

Checkpoint: "Fixed TreeView log format display"
