
# Руководство по переносу данных из deployed версии

## Шаги для переноса данных:

### 1. Создайте бэкап на deployed версии

На deployed версии приложения:

1. Перейдите в раздел "Управление бэкапами" (обычно /backups или /backup)
2. Нажмите "Создать бэкап"
3. Выберите тип "Только данные (data-only)" - это очень важно!
4. Дождитесь создания бэкапа
5. Скачайте созданный файл бэкапа (обычно называется `backup_data_YYYY-MM-DDTHH-MM-SS.sql`)

### 2. Загрузите бэкап в dev версию

Есть два способа:

#### Способ A: Через файловую систему (рекомендуется)

1. Скопируйте скачанный файл в директорию `/home/ubuntu/production_cost_system/backups/`
2. Убедитесь что файл имеет права доступа:
   ```bash
   chmod 644 /home/ubuntu/production_cost_system/backups/backup_data_*.sql
   ```

#### Способ B: Через UI (если будет реализовано)

1. В dev версии перейдите в раздел "Управление бэкапами"
2. Используйте функцию загрузки файла бэкапа
3. Выберите скачанный файл

### 3. Восстановите данные

1. В dev версии перейдите в раздел "Управление бэкапами"
2. Найдите загруженный бэкап в списке
3. Нажмите "Восстановить" рядом с файлом
4. Подтвердите действие (ВНИМАНИЕ: текущие данные будут заменены!)
5. Дождитесь завершения процесса восстановления
6. Страница автоматически перезагрузится

### 4. Проверьте данные

После восстановления проверьте что все данные на месте:
- Товары
- Материалы
- Оборудование
- Роли
- Производственные процессы
- Операции
- Заказы

## Важные замечания:

- **Тип бэкапа**: Используйте только "data-only" бэкапы для переноса между dev и deploy версиями. Full бэкапы могут вызвать конфликты схемы.
- **Автоматические бэкапы**: В deployed версии создаются автоматические бэкапы каждый час. Вы можете использовать любой из них.
- **Безопасность**: Перед восстановлением в dev версии автоматически создается бэкап текущих данных.
- **Конфликты ID**: При восстановлении все существующие данные будут удалены и заменены данными из бэкапа.

## Альтернативный способ (через командную строку):

Если у вас есть SSH доступ к серверам:

```bash
# На deployed сервере - создать бэкап
cd /home/ubuntu/production_cost_system
NODE_PATH=./app/node_modules node backup-node.js data-only

# Скачать файл бэкапа
scp user@deployed-server:/home/ubuntu/production_cost_system/backups/backup_data_*.sql /tmp/

# На dev сервере - скопировать бэкап
scp /tmp/backup_data_*.sql user@dev-server:/home/ubuntu/production_cost_system/backups/

# На dev сервере - восстановить
cd /home/ubuntu/production_cost_system
psql "$DATABASE_URL" < backups/backup_data_*.sql
```

## Помощь

Если у вас возникли проблемы:
1. Проверьте логи в консоли браузера (F12)
2. Проверьте логи сервера
3. Убедитесь что файл бэкапа не поврежден
4. Попробуйте создать новый бэкап на deployed версии
