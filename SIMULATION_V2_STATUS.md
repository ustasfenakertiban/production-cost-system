
# –°—Ç–∞—Ç—É—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å–∏–º—É–ª—è—Ü–∏–∏ v2 (–û–û–ü)

## ‚úÖ –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (–ó–ê–í–ï–†–®–ï–ù)

### 1.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ Prisma Schema:**

#### –ú–æ–¥–µ–ª—å Material (—Ä–∞—Å—à–∏—Ä–µ–Ω–∞)
```prisma
model Material {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
  minStockPercentage Float?  @default(0)  // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–µ—Å–Ω–∏–∂–∞–µ–º—ã–π –æ—Å—Ç–∞—Ç–æ–∫ (%)
  batchSize          Float?               // –†–∞–∑–º–µ—Ä –ø–∞—Ä—Ç–∏–∏ –∑–∞–∫—É–ø–∫–∏
}
```

#### –ù–æ–≤–∞—è –º–æ–¥–µ–ª—å SimulationSettings
```prisma
model SimulationSettings {
  id                String   @id @default(cuid())
  payIdleTime       Boolean  @default(true)   // –î–æ–ø–ª–∞—á–∏–≤–∞—Ç—å –∑–∞ –ø—Ä–æ—Å—Ç–æ–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º
  enablePartialWork Boolean  @default(true)   // –í—ã–ø–æ–ª–Ω—è—Ç—å —á–∞—Å—Ç–∏—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞, Prisma Client —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω

### 1.2 –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (–û–û–ü)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤:**
```
lib/simulation-v2/
‚îú‚îÄ‚îÄ types.ts                  ‚úÖ –¢–∏–ø—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚îú‚îÄ‚îÄ ResourceManager.ts        ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏
‚îú‚îÄ‚îÄ Operation.ts              ‚úÖ –ö–ª–∞—Å—Å –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ OperationChain.ts         ‚úÖ –ö–ª–∞—Å—Å —Ü–µ–ø–æ—á–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π
‚îú‚îÄ‚îÄ SimulationEngine.ts       ‚úÖ –ì–ª–∞–≤–Ω—ã–π –¥–≤–∏–∂–æ–∫
‚îú‚îÄ‚îÄ dataLoader.ts             ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î
‚îú‚îÄ‚îÄ index.ts                  ‚úÖ –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îî‚îÄ‚îÄ README.md                 ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã:**

1. **SimulationEngine** - –ì–ª–∞–≤–Ω—ã–π –¥–≤–∏–∂–æ–∫ —Å–∏–º—É–ª—è—Ü–∏–∏
2. **ResourceManager** - –ú–µ–Ω–µ–¥–∂–µ—Ä —Ä–µ—Å—É—Ä—Å–æ–≤
3. **Operation** - –ö–ª–∞—Å—Å –æ–ø–µ—Ä–∞—Ü–∏–∏
4. **OperationChain** - –ö–ª–∞—Å—Å —Ü–µ–ø–æ—á–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π

### 1.3 API Endpoints

- ‚úÖ `/api/simulation-settings` - GET/POST –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–∏–º—É–ª—è—Ü–∏–∏

### 1.4 UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- ‚úÖ –§–æ—Ä–º–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –æ—Å—Ç–∞—Ç–∫–∞ –∏ —Ä–∞–∑–º–µ—Ä–∞ –ø–∞—Ä—Ç–∏–∏

## üöß –≠—Ç–∞–ø 2: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–ó–ê–í–ï–†–®–ï–ù)

### –í—ã–ø–æ–ª–Ω–µ–Ω–æ:
- ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è dataLoader - –∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î
- ‚úÖ –°–æ–∑–¥–∞–Ω API endpoint `/api/simulation-v2/run`
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ `lib/simulation-v2/index.ts`
- ‚úÖ –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω —á–µ–∫–ø–æ–∏–Ω—Ç —Å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π v2

### –°—Ç–∞—Ç—É—Å:
–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ v2 –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –ü–æ–∫–∞ v2 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–≤–∏–∂–æ–∫ v1 –∫–∞–∫ fallback —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫ v2 (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ).

## ‚úÖ –≠—Ç–∞–ø 3: –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è v2 (–ó–ê–í–ï–†–®–ï–ù)

### –í—ã–ø–æ–ª–Ω–µ–Ω–æ:
- ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è SimulationEngine v2
  - ‚úÖ –õ–æ–≥–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å —É—á–µ—Ç–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫ v2
  - ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Å—Ç–æ—è —Ä–µ—Å—É—Ä—Å–æ–≤ (enablePartialWork)
  - ‚úÖ –ì–∏–±–∫–∞—è –æ–ø–ª–∞—Ç–∞ –ø—Ä–æ—Å—Ç–æ—è (payIdleTime)
  - ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ (minStockPercentage, batchSize)
- ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è ResourceManager
- ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Operation –∏ OperationChain –∫–ª–∞—Å—Å–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø–æ–ª–Ω—ã–π —Ä–∞—Å—á–µ—Ç –∑–∞—Ç—Ä–∞—Ç —Å –Ω–æ–≤—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ v2
  - ‚úÖ –ó–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—ã (—Å —É—á–µ—Ç–æ–º –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –æ—Å—Ç–∞—Ç–∫–∞ –∏ —Ä–∞–∑–º–µ—Ä–∞ –ø–∞—Ä—Ç–∏–∏)
  - ‚úÖ –ó–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ (—Å —É—á–µ—Ç–æ–º –∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏–∏)
  - ‚úÖ –ó–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª (—Å —É—á–µ—Ç–æ–º –æ–ø–ª–∞—Ç—ã –ø—Ä–æ—Å—Ç–æ—è)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–Ω–æ–ø–∫–∏ –≤ UI –¥–ª—è –∑–∞–ø—É—Å–∫–∞ v1 –∏ v2
- ‚úÖ –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω

**–°—Ç–∞—Ç—É—Å: –ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ**

## üìä –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ v2

### 1. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
- –†–∞–∑–º–µ—Ä –ø–∞—Ä—Ç–∏–∏ –∑–∞–∫—É–ø–∫–∏
- –ü—Ä–æ—Ü–µ–Ω—Ç –Ω–µ—Å–Ω–∏–∂–∞–µ–º–æ–≥–æ –æ—Å—Ç–∞—Ç–∫–∞

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Å—Ç–æ—è —Ä–µ—Å—É—Ä—Å–æ–≤
- –ß–∞—Å—Ç–∏—á–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–∞–∏–≤–∞—é—â–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤

### 3. –ì–∏–±–∫–∞—è –æ–ø–ª–∞—Ç–∞ –ø—Ä–æ—Å—Ç–æ—è
- –î–≤–∞ —Ä–µ–∂–∏–º–∞: —Å –æ–ø–ª–∞—Ç–æ–π –ø—Ä–æ—Å—Ç–æ—è –∏ –±–µ–∑

### 4. –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –£—á–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
- –í—ã—è–≤–ª–µ–Ω–∏–µ —É–∑–∫–∏—Ö –º–µ—Å—Ç

## üìù –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ v2

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–û–û–ü)
- **SimulationEngine** - –≥–ª–∞–≤–Ω—ã–π –¥–≤–∏–∂–æ–∫ —Å–∏–º—É–ª—è—Ü–∏–∏ —Å –ø–æ–ª–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **ResourceManager** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏ (–º–∞—Ç–µ—Ä–∏–∞–ª—ã, –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ, —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏)
- **Operation** - –∫–ª–∞—Å—Å –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ä–∞—Å—á–µ—Ç–æ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –∑–∞—Ç—Ä–∞—Ç
- **OperationChain** - –∫–ª–∞—Å—Å —Ü–µ–ø–æ—á–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π (ONE_TIME / PER_UNIT)

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
1. **–£–º–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–∫—É–ø–∫–∞ —Å —É—á–µ—Ç–æ–º –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –æ—Å—Ç–∞—Ç–∫–∞
   - –ó–∞–∫—É–ø–∫–∞ —Ü–µ–ª—ã–º–∏ –ø–∞—Ä—Ç–∏—è–º–∏ (batchSize)
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–∫—É–ø–æ–∫ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤

2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤**
   - –ß–∞—Å—Ç–∏—á–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π (enablePartialWork)
   - –ü–æ–∏—Å–∫ —É–∑–∫–∏—Ö –º–µ—Å—Ç (bottleneck)
   - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ

3. **–ì–∏–±–∫–∞—è –æ–ø–ª–∞—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞**
   - –û–ø–ª–∞—Ç–∞ –ø—Ä–æ—Å—Ç–æ—è (payIdleTime) - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
   - –£—á–µ—Ç —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –ø—Ä–æ—Å—Ç–æ—è
   - –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–∂–¥–æ–º—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É

4. **–î–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å**
   - –ü–æ–ª–Ω–∞—è —Ä–∞–∑–±–∏–≤–∫–∞ –∑–∞—Ç—Ä–∞—Ç –ø–æ –æ–ø–µ—Ä–∞—Ü–∏—è–º
   - –£—Ç–∏–ª–∏–∑–∞—Ü–∏—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
   - –†–∞—Å—Ö–æ–¥ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏ –∑–∞–∫—É–ø–∫–∏

### UI
- –î–≤–µ –∫–Ω–æ–ø–∫–∏: "–ó–∞–ø—É—Å—Ç–∏—Ç—å v1" –∏ "–ó–∞–ø—É—Å—Ç–∏—Ç—å v2 (–û–û–ü) üÜï"
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Ç–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
- –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≥—Ä–∞—Ñ–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ v2

---

**–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞:** 16.10.2025
**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 16.10.2025
**–°—Ç–∞—Ç—É—Å:** –í—Å–µ 3 —ç—Ç–∞–ø–∞ –∑–∞–≤–µ—Ä—à–µ–Ω—ã
**–ß–µ–∫–ø–æ–∏–Ω—Ç:** –ì–æ—Ç–æ–≤ –∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—é
