
# –°—Ç–∞—Ç—É—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å–∏–º—É–ª—è—Ü–∏–∏ v2 (–û–û–ü)

## ‚úÖ –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (–ó–ê–í–ï–†–®–ï–ù)

### 1.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ Prisma Schema:**

#### –ú–æ–¥–µ–ª—å Material (—Ä–∞—Å—à–∏—Ä–µ–Ω–∞)
```prisma
model Material {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
  minStockPercentage Float?  @default(0)  // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–µ—Å–Ω–∏–∂–∞–µ–º—ã–π –æ—Å—Ç–∞—Ç–æ–∫ (%)
  batchSize          Float?               // –†–∞–∑–º–µ—Ä –ø–∞—Ä—Ç–∏–∏ –∑–∞–∫—É–ø–∫–∏
}
```

#### –ù–æ–≤–∞—è –º–æ–¥–µ–ª—å SimulationSettings
```prisma
model SimulationSettings {
  id                String   @id @default(cuid())
  payIdleTime       Boolean  @default(true)   // –î–æ–ø–ª–∞—á–∏–≤–∞—Ç—å –∑–∞ –ø—Ä–æ—Å—Ç–æ–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º
  enablePartialWork Boolean  @default(true)   // –í—ã–ø–æ–ª–Ω—è—Ç—å —á–∞—Å—Ç–∏—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞, Prisma Client —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω

### 1.2 –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (–û–û–ü)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤:**
```
lib/simulation-v2/
‚îú‚îÄ‚îÄ types.ts                  ‚úÖ –¢–∏–ø—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚îú‚îÄ‚îÄ ResourceManager.ts        ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏
‚îú‚îÄ‚îÄ Operation.ts              ‚úÖ –ö–ª–∞—Å—Å –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ OperationChain.ts         ‚úÖ –ö–ª–∞—Å—Å —Ü–µ–ø–æ—á–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π
‚îú‚îÄ‚îÄ SimulationEngine.ts       ‚úÖ –ì–ª–∞–≤–Ω—ã–π –¥–≤–∏–∂–æ–∫
‚îú‚îÄ‚îÄ dataLoader.ts             ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î
‚îú‚îÄ‚îÄ index.ts                  ‚úÖ –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îî‚îÄ‚îÄ README.md                 ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã:**

1. **SimulationEngine** - –ì–ª–∞–≤–Ω—ã–π –¥–≤–∏–∂–æ–∫ —Å–∏–º—É–ª—è—Ü–∏–∏
2. **ResourceManager** - –ú–µ–Ω–µ–¥–∂–µ—Ä —Ä–µ—Å—É—Ä—Å–æ–≤
3. **Operation** - –ö–ª–∞—Å—Å –æ–ø–µ—Ä–∞—Ü–∏–∏
4. **OperationChain** - –ö–ª–∞—Å—Å —Ü–µ–ø–æ—á–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π

### 1.3 API Endpoints

- ‚úÖ `/api/simulation-settings` - GET/POST –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–∏–º—É–ª—è—Ü–∏–∏

### 1.4 UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- ‚úÖ –§–æ—Ä–º–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –æ—Å—Ç–∞—Ç–∫–∞ –∏ —Ä–∞–∑–º–µ—Ä–∞ –ø–∞—Ä—Ç–∏–∏

## üöß –≠—Ç–∞–ø 2: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–ó–ê–í–ï–†–®–ï–ù)

### –í—ã–ø–æ–ª–Ω–µ–Ω–æ:
- ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è dataLoader - –∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î
- ‚úÖ –°–æ–∑–¥–∞–Ω API endpoint `/api/simulation-v2/run`
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ `lib/simulation-v2/index.ts`
- ‚úÖ –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω —á–µ–∫–ø–æ–∏–Ω—Ç —Å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π v2

### –°—Ç–∞—Ç—É—Å:
–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ v2 –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –ü–æ–∫–∞ v2 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–≤–∏–∂–æ–∫ v1 –∫–∞–∫ fallback —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫ v2 (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ).

## üìã –≠—Ç–∞–ø 3: –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è v2 (–ü–õ–ê–ù–ò–†–£–ï–¢–°–Ø)

### –¢—Ä–µ–±—É–µ—Ç—Å—è:
- [ ] –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é SimulationEngine v2
  - [ ] –õ–æ–≥–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å —É—á–µ—Ç–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫ v2
  - [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Å—Ç–æ—è —Ä–µ—Å—É—Ä—Å–æ–≤ (enablePartialWork)
  - [ ] –ì–∏–±–∫–∞—è –æ–ø–ª–∞—Ç–∞ –ø—Ä–æ—Å—Ç–æ—è (payIdleTime)
  - [ ] –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ (minStockPercentage, batchSize)
- [ ] –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é ResourceManager
- [ ] –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é Operation –∏ OperationChain –∫–ª–∞—Å—Å–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∑–∞—Ç—Ä–∞—Ç —Å –Ω–æ–≤—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ v2
- [ ] –°–æ–∑–¥–∞—Ç—å UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ v2
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏: 8-12 —á–∞—Å–æ–≤**

## üìä –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ v2

### 1. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
- –†–∞–∑–º–µ—Ä –ø–∞—Ä—Ç–∏–∏ –∑–∞–∫—É–ø–∫–∏
- –ü—Ä–æ—Ü–µ–Ω—Ç –Ω–µ—Å–Ω–∏–∂–∞–µ–º–æ–≥–æ –æ—Å—Ç–∞—Ç–∫–∞

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Å—Ç–æ—è —Ä–µ—Å—É—Ä—Å–æ–≤
- –ß–∞—Å—Ç–∏—á–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–∞–∏–≤–∞—é—â–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤

### 3. –ì–∏–±–∫–∞—è –æ–ø–ª–∞—Ç–∞ –ø—Ä–æ—Å—Ç–æ—è
- –î–≤–∞ —Ä–µ–∂–∏–º–∞: —Å –æ–ø–ª–∞—Ç–æ–π –ø—Ä–æ—Å—Ç–æ—è –∏ –±–µ–∑

### 4. –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –£—á–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
- –í—ã—è–≤–ª–µ–Ω–∏–µ —É–∑–∫–∏—Ö –º–µ—Å—Ç

---

**–î–∞—Ç–∞:** 16.10.2025
**–°—Ç–∞—Ç—É—Å:** –≠—Ç–∞–ø 1 –∑–∞–≤–µ—Ä—à–µ–Ω
**–ß–µ–∫–ø–æ–∏–Ω—Ç:** –°–æ—Ö—Ä–∞–Ω–µ–Ω
